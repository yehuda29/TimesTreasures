import{r as i,A as k,C as A,b as B,j as e,a as N,y as C}from"./index-TEer4uYd.js";import{c as g}from"./priceUtil-7XU-dkmR.js";const E="_paymentButtonContainer_exqaj_5",q={paymentButtonContainer:E},$=({amount:c,onSuccess:h,containerId:d="paypal-button-portal"})=>{const y=i.useRef(!1);return i.useEffect(()=>{if(y.current)return;const l=document.getElementById(d);if(!l){console.error(`No portal element found with id "${d}". Please add <div id="${d}"></div> in the desired location.`);return}const a=document.createElement("div");if(a.className=q.paymentButtonContainer,l.appendChild(a),!window.paypal){console.error("PayPal SDK not loaded. Please include the PayPal SDK script in your index.html.");return}return window.paypal.Buttons({createOrder:(s,r)=>r.order.create({purchase_units:[{amount:{value:c}}]}),onApprove:(s,r)=>r.order.capture().then(p=>{console.log("Order captured:",p),h(p)}).catch(p=>{console.error("Error capturing order:",p)}),onError:s=>{console.error("PayPal Buttons onError:",s)}}).render(a).then(()=>{y.current=!0}).catch(s=>{console.error("Error rendering PayPal buttons:",s)}),()=>{l.contains(a)&&l.removeChild(a)}},[c,h,d]),null},D="_checkoutContainer_1p9al_5",T="_addressStep_1p9al_23",O="_reviewStep_1p9al_25",F="_shippingTime_1p9al_169",z="_backButtonContainer_1p9al_185",R="_backBtn_1p9al_193",Z="_priceContainer_1p9al_233",H="_originalPrice_1p9al_245",K="_arrow_1p9al_253",L="_discountedPrice_1p9al_265",U="_specialOfferBadge_1p9al_275",I="_itemPriceDetail_1p9al_297",o={checkoutContainer:D,addressStep:T,reviewStep:O,shippingTime:F,backButtonContainer:z,backBtn:R,"paypal-button-portal":"_paypal-button-portal_1p9al_1",priceContainer:Z,originalPrice:H,arrow:K,discountedPrice:L,specialOfferBadge:U,itemPriceDetail:I},G=()=>{const{user:c,token:h}=i.useContext(k),{cartItems:d,clearCart:y}=i.useContext(A),l=B(),[a,s]=i.useState("address"),[r,p]=i.useState(null),[u,v]=i.useState({country:"",city:"",homeAddress:"",zipcode:"",phoneNumber:""}),[b,_]=i.useState(!1),m=t=>{v({...u,[t.target.name]:t.target.value})},j=d.reduce((t,n)=>{const x=g(n.watch);return t+x*n.quantity},0),P=async t=>{try{_(!0);const n=await N.post("http://localhost:5000/api/users/purchase",{shippingAddress:r},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});n.data.message&&n.data.message!=="Purchase completed successfully."&&C.error(n.data.message),y(h),_(!1),l("/purchase-history")}catch(n){_(!1),console.error("Checkout failed:",n),C.error("Checkout failed. Please try again.")}},f=()=>e.jsxs("div",{className:o.addressStep,children:[e.jsx("h2",{children:"Shipping Address"}),c&&c.addresses&&c.addresses.length>0&&e.jsxs("div",{children:[e.jsx("p",{children:"You have a saved address. Would you like to use it?"}),e.jsx("button",{onClick:()=>{p(c.addresses[0]),s("review")},children:"Use Saved Address"})]}),e.jsx("h3",{children:"Or enter a new address"}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),p(u),s("review")},children:[e.jsx("input",{type:"text",name:"country",placeholder:"Country",value:u.country,onChange:m,required:!0}),e.jsx("input",{type:"text",name:"city",placeholder:"City",value:u.city,onChange:m,required:!0}),e.jsx("input",{type:"text",name:"homeAddress",placeholder:"Home Address",value:u.homeAddress,onChange:m,required:!0}),e.jsx("input",{type:"text",name:"zipcode",placeholder:"Zipcode",value:u.zipcode,onChange:m,pattern:"\\d+",title:"Zipcode must contain numbers only",required:!0}),e.jsx("input",{type:"text",name:"phoneNumber",placeholder:"Phone Number",value:u.phoneNumber,onChange:m,pattern:"\\d{10}",maxLength:"10",title:"Phone number must be exactly 10 digits",required:!0}),e.jsx("button",{type:"submit",children:"Use This Address"})]})]}),S=()=>e.jsxs("div",{className:o.reviewStep,children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{children:[e.jsx("h3",{children:"Shipping Address:"}),e.jsxs("p",{children:["Country/State: ",r.country]}),e.jsxs("p",{children:["City: ",r.city]}),e.jsxs("p",{children:["Home Address: ",r.homeAddress]}),e.jsxs("p",{children:["Zipcode: ",r.zipcode]}),e.jsxs("p",{children:["Phone Number: ",r.phoneNumber]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Items:"}),e.jsx("ul",{children:d.map((t,n)=>{const x=g(t.watch),w=x<Number(t.watch.price);return e.jsxs("li",{children:[t.watch.name," x ",t.quantity," - $",(x*t.quantity).toFixed(2),w&&e.jsxs("span",{className:o.itemPriceDetail,children:[" ","(",e.jsxs("s",{children:["$",(Number(t.watch.price)*t.quantity).toFixed(2)]}),e.jsx("span",{className:o.arrow,children:"â†’"}),"$",(x*t.quantity).toFixed(2),")"]})]},n)})}),e.jsxs("h3",{children:["Total: $",j.toFixed(2)]})]}),e.jsx("p",{className:o.shippingTime,children:"Estimated Shipping Time: 14 to 21 business days"}),e.jsx("div",{id:"paypal-button-portal",children:e.jsx($,{amount:j.toFixed(2),onSuccess:P,containerId:"paypal-button-portal"})}),e.jsx("button",{onClick:()=>s("address"),children:"Edit Shipping Address"})]});return e.jsxs("div",{className:o.checkoutContainer,children:[e.jsx("div",{className:o.backButtonContainer,children:e.jsx("button",{className:o.backBtn,onClick:()=>l("/cart"),children:"Back to Cart"})}),b&&e.jsx("p",{children:"Processing your order..."}),a==="address"&&f(),a==="review"&&r&&S()]})};export{G as default};
