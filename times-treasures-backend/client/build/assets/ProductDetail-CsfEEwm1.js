import{u as $,b as D,r as s,C as F,A as T,j as e,a as u,y as n}from"./index-TEer4uYd.js";import{g as q}from"./imageUtil-CPgIs8eT.js";import{c as O}from"./priceUtil-7XU-dkmR.js";const W="_productDetail_1dfec_3",A="_productImage_1dfec_16",U="_productInfo_1dfec_24",E="_productName_1dfec_31",G="_productPrice_1dfec_37",L="_productDescription_1dfec_44",Q="_stockInfo_1dfec_51",z="_quantitySelector_1dfec_59",R="_buttonGroup_1dfec_79",H="_addToCartBtn_1dfec_86",J="_deleteBtn_1dfec_100",K="_updateStock_1dfec_115",M="_updateStockBtn_1dfec_135",V="_loader_1dfec_150",X="_priceContainer_1dfec_158",Y="_originalPrice_1dfec_164",Z="_arrow_1dfec_168",ee="_discountedPrice_1dfec_173",te="_specialOfferBadge_1dfec_178",o={productDetail:W,productImage:A,productInfo:U,productName:E,productPrice:G,productDescription:L,stockInfo:Q,quantitySelector:z,buttonGroup:R,addToCartBtn:H,deleteBtn:J,updateStock:K,updateStockBtn:M,loader:V,priceContainer:X,originalPrice:Y,arrow:Z,discountedPrice:ee,specialOfferBadge:te},re=()=>{const{id:d}=$(),p=D(),[t,h]=s.useState(null),[x,g]=s.useState(!0),[v,N]=s.useState(!1),[l,j]=s.useState(1),[f,m]=s.useState(""),{addToCart:k}=s.useContext(F),{user:i,token:_}=s.useContext(T);s.useEffect(()=>{(async()=>{try{const a=(await u.get(`http://localhost:5000/api/watches/${d}`)).data.data;if(!a||typeof a!="object")throw new Error("Invalid watch data");h(a),i&&i.role==="admin"&&m(a.inventory)}catch(r){console.error(r),N(!0)}finally{g(!1)}})()},[d,i]);const y=t?O(t):0,S=t&&y<Number(t.price),C=()=>{if(!i){n.error("Please login to make a purchase"),p("/login");return}if(t){if(t.inventory===0){n.error("This watch is out of stock");return}if(l>t.inventory){n.error(`Only ${t.inventory} available in stock`);return}const c=l<1?1:l;k({_id:t._id,quantity:c},_),n.success(`${t.name} (x${c}) added to your cart!`)}},w=async()=>{var c,r;try{const a=Number(f);if(isNaN(a)||a<0){n.error("Please enter a valid non-negative number for stock");return}const P={headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}},B=await u.put(`http://localhost:5000/api/watches/${d}`,{inventory:a},P);h(B.data.data),n.success("Stock updated successfully")}catch(a){console.error(a),n.error(((r=(c=a.response)==null?void 0:c.data)==null?void 0:r.message)||"Failed to update stock")}},I=c=>{m(c.target.value)},b=async()=>{var c,r;if(window.confirm("Are you sure you want to delete this watch?"))try{const a={headers:{Authorization:`Bearer ${_}`}};await u.delete(`http://localhost:5000/api/watches/${d}`,a),n.success("Watch deleted successfully"),p("/")}catch(a){console.error(a),n.error(((r=(c=a.response)==null?void 0:c.data)==null?void 0:r.message)||"Failed to delete watch")}};return x?e.jsx("p",{className:o.loader,children:"Loading..."}):v||!t?e.jsxs("div",{className:o.productDetail,children:[e.jsx("h2",{children:"Watch Not Found"}),e.jsx("p",{children:"The watch you are looking for does not exist."})]}):e.jsxs("div",{className:o.productDetail,children:[e.jsx("img",{src:q(t.image),alt:t.name,className:o.productImage}),e.jsxs("div",{className:o.productInfo,children:[e.jsx("h2",{className:o.productName,children:t.name}),S?e.jsxs("div",{className:o.priceContainer,children:[e.jsx("p",{className:o.originalPrice,children:e.jsxs("s",{children:["$",Number(t.price).toFixed(2)]})}),e.jsx("span",{className:o.arrow,children:"â†’"}),e.jsxs("p",{className:o.discountedPrice,children:["$",y.toFixed(2)]}),e.jsxs("p",{className:o.specialOfferBadge,children:[t.specialOffer.discountPercentage,"% OFF!"]})]}):e.jsxs("p",{className:o.productPrice,children:["$",Number(t.price).toFixed(2)]}),e.jsx("p",{className:o.productDescription,children:t.description}),e.jsx("p",{className:o.stockInfo,children:t.inventory>0?`In Stock: ${t.inventory}`:"Out of Stock"}),t.inventory>0&&e.jsxs("div",{className:o.quantitySelector,children:[e.jsx("label",{htmlFor:"quantity",children:"Quantity:"}),e.jsx("input",{type:"number",id:"quantity",name:"quantity",min:"1",max:t.inventory,value:l,onChange:c=>j(parseInt(c.target.value,10))})]}),e.jsxs("div",{className:o.buttonGroup,children:[e.jsx("button",{className:o.addToCartBtn,onClick:C,disabled:t.inventory===0,children:t.inventory===0?"Out of Stock":"Add to Cart"}),i&&i.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:o.deleteBtn,onClick:b,children:"Delete Watch"}),e.jsxs("div",{className:o.updateStock,children:[e.jsx("label",{htmlFor:"inventoryUpdate",children:"Update Stock:"}),e.jsx("input",{type:"number",id:"inventoryUpdate",name:"inventoryUpdate",min:"0",value:f,onChange:I}),e.jsx("button",{className:o.updateStockBtn,onClick:w,children:"Update Stock"})]})]})]})]})]})};export{re as default};
